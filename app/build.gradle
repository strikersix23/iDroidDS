apply plugin: 'com.android.application'

def getVersionCode = {
    try {
        def code = new ByteArrayOutputStream()
        exec {
            commandLine 'git', 'tag', '--list'
            standardOutput = code
        }
        return code.toString().split("\n").size()
    } catch (ignored) {
        return -1
    }
}

def getVersionName = {
    try {
        def stdout = new ByteArrayOutputStream()
        exec {
            commandLine 'git', 'describe', '--tags', '--dirty'
            standardOutput = stdout
        }
        return stdout.toString().trim()
    } catch (ignored) {
        return null;
    }
}
android {
    signingConfigs {
    }
    dependencies {
        api 'com.dropbox.core:dropbox-core-sdk:3.0.9'
    }
    compileSdkVersion 27
    defaultConfig {
        applicationId 'org.opendoorstudios.ds4droid'
        minSdkVersion 21
        targetSdkVersion 27
        versionCode getVersionCode()
        versionName getVersionName()
        ndk {
            abiFilters 'armeabi-v7a', 'arm64-v8a', 'x86', 'x86_64'
        }

    }
    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.txt'
        }
    }
    lintOptions {
        checkReleaseBuilds false
        abortOnError false
    }
    externalNativeBuild {
        ndkBuild {
            path 'src/main/jni/Android.mk'
        }
    }
    productFlavors {
    }
    buildToolsVersion '28.0.3'
}

dependencies {
    implementation files('libs/ouya-sdk.jar')
    api 'net.sf.sevenzipjbinding:sevenzipjbinding:9.20-2.00beta'
    implementation 'net.sf.sevenzipjbinding:sevenzipjbinding-linux-arm:9.20-2.00beta'
}
